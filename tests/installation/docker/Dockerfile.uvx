# Test: uvx ros-mcp installation from git
# This Dockerfile verifies the uvx installation method works with a git branch.
#
# Usage: docker build -f tests/installation/docker/Dockerfile.uvx \
#          --build-arg REPO_URL=https://github.com/robotmcp/ros-mcp-server.git \
#          --build-arg BRANCH=main .

FROM python:3.10-slim

# Build arguments for git-based installation
ARG REPO_URL=https://github.com/robotmcp/ros-mcp-server.git
ARG BRANCH=main

# Install curl for downloading uv, git, and OpenCV dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl ca-certificates git libgl1 libglib2.0-0 && \
    rm -rf /var/lib/apt/lists/*

# Install uv (as documented in installation.md)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

# Add uv to PATH
ENV PATH="/root/.local/bin:$PATH"

# Verify uv is installed
RUN uv --version

# Run ros-mcp using uvx from git repository
# This downloads and runs ros-mcp from the specified branch
RUN uvx --from "git+${REPO_URL}@${BRANCH}" ros-mcp --help

# Test: uv sync from source (git clone + uv sync + uv run)
# This Dockerfile verifies development installation using uv works.
#
# Usage: docker build -f tests/installation/docker/Dockerfile.uv-source .

FROM python:3.10-slim

# Install curl for downloading uv and OpenCV dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl ca-certificates libgl1 libglib2.0-0 && \
    rm -rf /var/lib/apt/lists/*

# Install uv (as documented)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

# Add uv to PATH
ENV PATH="/root/.local/bin:$PATH"

# Verify uv is installed
RUN uv --version

# Copy the repository (build context should be repo root)
COPY . /ros-mcp-server
WORKDIR /ros-mcp-server

# Sync dependencies using uv (development installation)
RUN uv sync

# Verify ros-mcp runs via uv run
RUN uv run ros-mcp --help

# Final success message
RUN echo "SUCCESS: uv sync from source works correctly"

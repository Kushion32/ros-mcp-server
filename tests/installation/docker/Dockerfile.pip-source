# Test: pip install ros-mcp from source (git clone + pip install .)
# This Dockerfile verifies that installation from cloned repository works.
#
# Usage: docker build -f tests/installation/docker/Dockerfile.pip-source .

FROM python:3.10-slim

# Install git and OpenCV dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    git libgl1 libglib2.0-0 && \
    rm -rf /var/lib/apt/lists/*

# Copy the repository (build context should be repo root)
COPY . /ros-mcp-server
WORKDIR /ros-mcp-server

# Upgrade pip
RUN pip install --upgrade pip

# Install from source (as documented for development)
RUN pip install .

# Verify the installation works
RUN ros-mcp --help

# Verify the package is importable
RUN python -c "import ros_mcp; print('ros-mcp installed from source successfully')"

# Final success message
RUN echo "SUCCESS: pip install from source works correctly"
